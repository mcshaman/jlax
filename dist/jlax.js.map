{"version":3,"file":"jlax.js","sources":["lib/jlax.js"],"sourcesContent":["const DEFAULT_OPTIONS = {\n\tviewPort: document,\n\tclassName: 'jlax',\n\tspeed: 1,\n}\n\nmodule.exports = class JLax {\n\tconstructor(pOptions) {\n\t\tconst options = Object.assign({}, DEFAULT_OPTIONS, pOptions)\n\n\t\tif (options.viewPort === document) {\n\t\t\toptions.viewPort = window\n\t\t}\n\n\t\tthis._viewPort = options.viewPort\n\t\tthis._viewPortHeight = null\n\t\tthis._className = options.className\n\t\tthis._speed = options.speed\n\t\tthis._items = []\n\t\tthis._scrollHandler = () => {\n\t\t\trequestAnimationFrame(this._render.bind(this))\n\t\t}\n\t\tthis._loadHandler = (pEvent) => {\n\t\t\tpEvent.target.removeEventListener('load', this._loadHandler)\n\t\t\n\t\t\tthis._initaliseItem(this._items.find(pItem => pItem.image === pEvent.target))\n\t\t}\n\t}\n\n\t_initaliseItem(pItem) {\n\t\tconst {element, image} = pItem\n\t\tconst elementWidth = element.clientWidth\n\t\tconst elementHeight = element.clientHeight\n\t\t\n\t\tpItem.coverHeight = Math.max(this._viewPortHeight, elementHeight) * this._speed\n\n\t\tconst coverRatio = elementWidth / pItem.coverHeight\n\t\tconst imageRatio = image.width / image.height\n\n\t\t\n\t\tif (coverRatio > imageRatio) {\n\t\t\telement.style.backgroundSize = 'cover'\n\t\t} else {\n\t\t\telement.style.backgroundSize = `auto ${pItem.coverHeight}px`\n\t\t}\n\n\t\tconst elementTop = element.offsetTop\n\t\tpItem.scrollEntry = elementTop - this._viewPortHeight\n\t\tpItem.scrollExit = elementTop + element.clientHeight\n\t\tpItem.ready = true\n\n\t\trequestAnimationFrame(this._render.bind(this))\n\t}\n\n\t_getViewPortScroll() {\n\t\tconst viewPort = this._viewPort\n\t\tif (viewPort === window) {\n\t\t\tconst element = document.documentElement\n\t\t\treturn (window.pageYOffset || element.scrollTop) - (element.clientTop || 0)\n\t\t}\n\n\t\treturn viewPort.scrollTop\n\t}\n\n\t_render() {\n\t\tconst viewPortScroll = this._getViewPortScroll()\n\t\tconst viewPortHeight = this._viewPortHeight\n\n\t\tthis._items.forEach(pItem => {\n\t\t\tif (!pItem.ready || pItem.scrollEntry >= viewPortScroll || pItem.scrollExit <= viewPortScroll) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst elementHalf = pItem.element.clientHeight / 2\n\t\t\tconst elementCentre = pItem.element.offsetTop + elementHalf\n\t\n\t\t\tconst intersectRangeTop = viewPortScroll - elementHalf\n\t\t\tconst intersectRangeHeight = viewPortHeight + pItem.element.clientHeight\n\n\t\t\tconst elementCentreNormalised = elementCentre - intersectRangeTop\n\t\t\tconst intersectRatio = (intersectRangeHeight - elementCentreNormalised) / intersectRangeHeight\n\n\t\t\tconst heightDifference = pItem.coverHeight - viewPortHeight\n\t\t\t\t\n\t\t\tconst backgroundOffsetNormalised = intersectRangeHeight * intersectRatio - pItem.coverHeight\n\t\t\t\t\n\t\t\tconst difRatio = heightDifference * intersectRatio\n\n\t\t\tpItem.element.style.backgroundPositionY = `${backgroundOffsetNormalised + difRatio}px`\n\t\t})\n\t}\n\n\tinitalise() {\n\t\tconst viewPort = this._viewPort\n\n\t\tviewPort.addEventListener('scroll', this._scrollHandler)\n\n\t\tif (viewPort === window) {\n\t\t\tthis._viewPortHeight = window.innerHeight\n\t\t} else {\n\t\t\tthis._viewPortHeight = viewPort.clientHeight\n\n\t\t\tviewPort.style.overflowY = 'scroll'\n\t\t\tviewPort.style.position = 'relative'\n\t\t}\n\n\t\tconst loadHandler = this._loadHandler\n\t\tthis._items = [...document.getElementsByClassName(this._className)].map(pElement => {\n\t\t\tconst backgroundImage = getComputedStyle(pElement).backgroundImage\n\n\t\t\tconst image = new Image()\n\t\t\timage.src = backgroundImage.replace(/url\\(['\"]?(.*?)['\"]?\\)/, '$1')\n\t\t\timage.addEventListener('load', loadHandler)\n\n\t\t\treturn {\n\t\t\t\telement: pElement,\n\t\t\t\tready: false,\n\t\t\t\timage,\n\t\t\t\tcoverHeight: null,\n\t\t\t}\n\t\t})\n\t}\n\n\tdeinitialise() {\n\t\tconst viewPort = this._viewPort\n\n\t\tif (viewPort !== window) {\n\t\t\tviewPort.style.position = ''\n\t\t\tviewPort.style.overflowY = ''\n\t\t}\n\n\t\tthis._viewPort.removeEventListener('scroll', this._scrollHandler)\n\n\t\tthis._items.forEach(pItem => {\n\t\t\tpItem.element.style.backgroundSize = ''\n\t\t\tpItem.element.style.backgroundPositionY = ''\n\t\t})\n\n\t\tthis._items = []\n\t}\n}\n"],"names":["DEFAULT_OPTIONS","viewPort","document","className","speed","module","pOptions","options","Object","assign","window","_viewPort","_viewPortHeight","_className","_speed","_items","_scrollHandler","requestAnimationFrame","_render","bind","_loadHandler","pEvent","target","removeEventListener","_initaliseItem","find","pItem","image","element","elementWidth","clientWidth","elementHeight","clientHeight","coverHeight","Math","max","coverRatio","imageRatio","width","height","style","backgroundSize","elementTop","offsetTop","scrollEntry","scrollExit","ready","documentElement","pageYOffset","scrollTop","clientTop","viewPortScroll","_getViewPortScroll","viewPortHeight","forEach","elementHalf","elementCentre","intersectRangeHeight","intersectRatio","heightDifference","backgroundOffsetNormalised","backgroundPositionY","addEventListener","innerHeight","overflowY","position","loadHandler","getElementsByClassName","map","pElement","backgroundImage","getComputedStyle","Image","src","replace"],"mappings":"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"}