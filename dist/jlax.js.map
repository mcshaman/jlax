{"version":3,"file":"jlax.js","sources":["lib/jlax.js"],"sourcesContent":["if (typeof window === undefined) {\n\tthrow new Error('jLax is a browser only library') // To do: Write better error message\n}\n\nconst DEFAULT_OPTIONS = {\n\tscroller: document,\n\telements: '.jlax',\n\tspeed: 1,\n}\n\nfunction nullifyProperties(pThis) {\n\tpThis._items = null\n\tpThis._scroller = null\n\tpThis._scrollerHeight = null\n\tpThis._speed = null\n}\n\nmodule.exports = class JLax {\n\t// To do: JSDoc constructor parameters\n\n\tconstructor(pOptions) {\n\t\tthis.options = Object.assign({}, DEFAULT_OPTIONS, pOptions)\n\n\t\tnullifyProperties(this)\n\n\t\tthis._scrollHandler = () => {\n\t\t\trequestAnimationFrame(this._render.bind(this))\n\t\t}\n\n\t\tthis._loadHandler = (pEvent) => {\n\t\t\tpEvent.target.removeEventListener('load', this._loadHandler)\n\t\t\n\t\t\tthis._initaliseItem(this._items.find(pItem => pItem.image === pEvent.target))\n\t\t}\n\t}\n\n\t_initaliseItem(pItem) {\n\t\tconst {element, image} = pItem\n\t\tconst elementWidth = element.clientWidth\n\t\tconst elementHeight = element.clientHeight\n\t\t\n\t\tpItem.coverHeight = Math.max(this._scrollerHeight, elementHeight) * this._speed\n\n\t\tconst coverRatio = elementWidth / pItem.coverHeight\n\t\tconst imageRatio = image.width / image.height\n\n\t\t\n\t\tif (coverRatio > imageRatio) {\n\t\t\telement.style.backgroundSize = 'cover'\n\t\t} else {\n\t\t\telement.style.backgroundSize = `auto ${pItem.coverHeight}px`\n\t\t}\n\n\t\tconst elementTop = element.offsetTop\n\t\tpItem.scrollEntry = elementTop - this._scrollerHeight\n\t\tpItem.scrollExit = elementTop + element.clientHeight\n\t\tpItem.ready = true\n\n\t\trequestAnimationFrame(this._render.bind(this))\n\t}\n\n\t_getScrollerPosition() {\n\t\tif (this._scroller === window) {\n\t\t\tconst element = document.documentElement\n\t\t\treturn (window.pageYOffset || element.scrollTop) - (element.clientTop || 0)\n\t\t}\n\n\t\treturn this._scroller.scrollTop\n\t}\n\n\t_render() {\n\t\tconst scrollerPosition = this._getScrollerPosition()\n\n\t\tthis._items.forEach(pItem => {\n\t\t\tif (!pItem.ready || pItem.scrollEntry >= scrollerPosition || pItem.scrollExit <= scrollerPosition) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst elementHalf = pItem.element.clientHeight / 2\n\t\t\tconst elementCentre = pItem.element.offsetTop + elementHalf\n\t\n\t\t\tconst intersectRangeTop = scrollerPosition - elementHalf\n\t\t\tconst intersectRangeHeight = this._scrollerHeight + pItem.element.clientHeight\n\n\t\t\tconst elementCentreNormalised = elementCentre - intersectRangeTop\n\t\t\tconst intersectRatio = (intersectRangeHeight - elementCentreNormalised) / intersectRangeHeight\n\n\t\t\tconst heightDifference = pItem.coverHeight - this._scrollerHeight\n\t\t\t\t\n\t\t\tconst backgroundOffsetNormalised = intersectRangeHeight * intersectRatio - pItem.coverHeight\n\t\t\t\t\n\t\t\tconst difRatio = heightDifference * intersectRatio\n\n\t\t\tpItem.element.style.backgroundPositionY = `${backgroundOffsetNormalised + difRatio}px`\n\t\t})\n\t}\n\n\tinitalise() {\n\t\tconst {options} = this\n\n\t\tthis._speed = options.speed\n\t\tthis._scroller = options.scroller === document ? window : options.scroller // To do: ensure calculations are correct relative to this object when paralax item is nested within other relative container elements\n\n\t\tthis._scroller.addEventListener('scroll', this._scrollHandler)\n\n\t\tif (this._scroller === window) {\n\t\t\tthis._scrollerHeight = window.innerHeight\n\t\t} else {\n\t\t\tthis._scrollerHeight = this._scroller.clientHeight\n\n\t\t\tthis._scroller.style.overflowY = 'scroll'\n\n\t\t\tconst {position} = getComputedStyle(this._scroller)\n\t\t\tif (position !== 'absolute' && position !== 'relative') {\n\t\t\t\tthis._scroller.style.position = 'relative'\n\t\t\t}\n\t\t}\n\n\t\tlet elements\n\t\tif (typeof options.elements === 'string') {\n\t\t\tconst scrollerElement = options.scroller === window ? document : options.scroller\n\t\t\telements = [...scrollerElement.querySelectorAll(options.elements)]\n\t\t} else {\n\t\t\telements = options.elements\n\t\t}\n\n\t\tthis._items = elements.reduce((pItems, pElement) => {\n\t\t\tconst {backgroundImage} = getComputedStyle(pElement)\n\n\t\t\tif (backgroundImage) {\n\t\t\t\tconst pattern = /(?:url\\(['\"])((?:http(?:s)?:\\/\\/)?[\\w.-]+(?:\\.[\\w.-]+)*[\\w\\-._~:/?#[\\]@!$&'()*+,;=.]+)(?:['\"]\\))/g\n\t\t\t\tconst matches = pattern.exec(backgroundImage)\n\n\t\t\t\tif (matches) {\n\t\t\t\t\tconst image = new Image()\n\t\t\t\t\timage.src = matches[1] // To do: cater for multiple background images\n\t\t\t\t\timage.addEventListener('load', this._loadHandler)\n\n\t\t\t\t\tpItems.push({\n\t\t\t\t\t\telement: pElement,\n\t\t\t\t\t\tready: false, // To do: re-label to initalised\n\t\t\t\t\t\timage,\n\t\t\t\t\t\tcoverHeight: null,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn pItems\n\t\t}, [])\n\n\t\treturn this\n\t}\n\n\tdeinitialise() {\n\t\tif (this._scroller !== window) {\n\t\t\tthis._scroller.style.position = ''\n\t\t\tthis._scroller.style.overflowY = ''\n\t\t}\n\n\t\tthis._scroller.removeEventListener('scroll', this._scrollHandler)\n\n\t\tthis._items.forEach(pItem => {\n\t\t\tpItem.element.style.backgroundSize = ''\n\t\t\tpItem.element.style.backgroundPositionY = ''\n\t\t})\n\n\t\tnullifyProperties(this)\n\n\t\treturn this\n\t}\n}"],"names":["window","Error","DEFAULT_OPTIONS","scroller","document","elements","speed","nullifyProperties","pThis","_items","_scroller","_scrollerHeight","_speed","module","pOptions","options","Object","assign","_scrollHandler","requestAnimationFrame","_render","bind","_loadHandler","pEvent","target","removeEventListener","_initaliseItem","find","pItem","image","element","elementWidth","clientWidth","elementHeight","clientHeight","coverHeight","Math","max","coverRatio","imageRatio","width","height","style","backgroundSize","elementTop","offsetTop","scrollEntry","scrollExit","ready","documentElement","pageYOffset","scrollTop","clientTop","scrollerPosition","_getScrollerPosition","forEach","elementHalf","elementCentre","intersectRangeHeight","intersectRatio","heightDifference","backgroundOffsetNormalised","backgroundPositionY","addEventListener","innerHeight","overflowY","getComputedStyle","position","scrollerElement","querySelectorAll","reduce","pItems","pElement","backgroundImage","pattern","matches","exec","Image","src","push"],"mappings":"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"}