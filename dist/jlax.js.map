{"version":3,"file":"jlax.js","sources":["lib/jlax.js"],"sourcesContent":["const DEFAULT_OPTIONS = {\n\tviewPort: document,\n\tclassName: 'jlax',\n\tspeed: 1,\n}\n\nmodule.exports = class JLax {\n\tconstructor(pOptions) {\n\t\tconst options = Object.assign({}, DEFAULT_OPTIONS, pOptions)\n\n\t\tif (options.viewPort === document) {\n\t\t\toptions.viewPort = window\n\t\t}\n\n\t\tthis._viewPort = options.viewPort\n\t\tthis._viewPortHeight = null\n\t\tthis._className = options.className\n\t\tthis._speed = options.speed\n\t\tthis._items = []\n\t\tthis._scrollHandler = () => {\n\t\t\trequestAnimationFrame(this._render.bind(this))\n\t\t}\n\t\tthis._loadHandler = (pEvent) => {\n\t\t\tpEvent.target.removeEventListener('load', this._loadHandler)\n\t\t\n\t\t\tthis._initaliseItem(this._items.find(pItem => pItem.image === pEvent.target))\n\t\t}\n\t}\n\n\t_initaliseItem(pItem) {\n\t\tconst {element, image} = pItem\n\t\tconst elementWidth = element.clientWidth\n\t\tconst elementHeight = element.clientHeight\n\t\t\n\t\tpItem.coverHeight = Math.max(this._viewPortHeight, elementHeight) * this._speed\n\n\t\tconst coverRatio = elementWidth / pItem.coverHeight\n\t\tconst imageRatio = image.width / image.height\n\n\t\t\n\t\tif (coverRatio > imageRatio) {\n\t\t\telement.style.backgroundSize = 'cover'\n\t\t} else {\n\t\t\telement.style.backgroundSize = `auto ${pItem.coverHeight}px`\n\t\t}\n\n\t\tconst elementTop = element.offsetTop\n\t\tpItem.scrollEntry = elementTop - this._viewPortHeight\n\t\tpItem.scrollExit = elementTop + element.clientHeight\n\t\tpItem.ready = true\n\n\t\trequestAnimationFrame(this._render.bind(this))\n\t}\n\n\t_getViewPortScroll() {\n\t\tconst viewPort = this._viewPort\n\t\tif (viewPort === window) {\n\t\t\tconst element = document.documentElement\n\t\t\treturn (window.pageYOffset || element.scrollTop) - (element.clientTop || 0)\n\t\t}\n\n\t\treturn viewPort.scrollTop\n\t}\n\n\t_render() {\n\t\tconst viewPortScroll = this._getViewPortScroll()\n\t\tconst viewPortHeight = this._viewPortHeight\n\n\t\tthis._items.forEach(pItem => {\n\t\t\tif (!pItem.ready || pItem.scrollEntry >= viewPortScroll || pItem.scrollExit <= viewPortScroll) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst elementHalf = pItem.element.clientHeight / 2\n\t\t\tconst elementCentre = pItem.element.offsetTop + elementHalf\n\t\n\t\t\tconst intersectRangeTop = viewPortScroll - elementHalf\n\t\t\tconst intersectRangeHeight = viewPortHeight + pItem.element.clientHeight\n\n\t\t\tconst elementCentreNormalised = elementCentre - intersectRangeTop\n\t\t\tconst intersectRatio = (intersectRangeHeight - elementCentreNormalised) / intersectRangeHeight\n\n\t\t\tconst heightDifference = pItem.coverHeight - viewPortHeight\n\t\t\t\t\n\t\t\tconst backgroundOffsetNormalised = intersectRangeHeight * intersectRatio - pItem.coverHeight\n\t\t\t\t\n\t\t\tconst difRatio = heightDifference * intersectRatio\n\n\t\t\tpItem.element.style.backgroundPositionY = `${backgroundOffsetNormalised + difRatio}px`\n\t\t})\n\t}\n\n\tinitalise() {\n\t\tconst viewPort = this._viewPort\n\n\t\tviewPort.addEventListener('scroll', this._scrollHandler)\n\n\t\tif (viewPort === window) {\n\t\t\tthis._viewPortHeight = window.innerHeight\n\t\t} else {\n\t\t\tthis._viewPortHeight = viewPort.clientHeight\n\n\t\t\tviewPort.style.overflowY = 'scroll'\n\t\t\tviewPort.style.position = 'relative'\n\t\t}\n\n\t\tconst loadHandler = this._loadHandler\n\t\tthis._items = [...document.getElementsByClassName(this._className)].map(pElement => {\n\t\t\tconst backgroundImage = getComputedStyle(pElement).backgroundImage\n\n\t\t\tconst image = new Image()\n\t\t\timage.src = backgroundImage.replace(/url\\(['\"]?(.*?)['\"]?\\)/, '$1')\n\t\t\timage.addEventListener('load', loadHandler)\n\n\t\t\treturn {\n\t\t\t\telement: pElement,\n\t\t\t\tready: false,\n\t\t\t\timage,\n\t\t\t\tcoverHeight: null,\n\t\t\t}\n\t\t})\n\t}\n\n\tdeinitialise() {\n\t\tconst viewPort = this._viewPort\n\n\t\tif (viewPort !== window) {\n\t\t\tviewPort.style.position = ''\n\t\t\tviewPort.style.overflowY = ''\n\t\t}\n\n\t\tthis._viewPort.removeEventListener('scroll', this._scrollHandler)\n\n\t\tthis._items.forEach(pItem => {\n\t\t\tpItem.element.style.backgroundSize = ''\n\t\t\tpItem.element.style.backgroundPositionY = ''\n\t\t})\n\n\t\tthis._items = []\n\t}\n}\n"],"names":["DEFAULT_OPTIONS","viewPort","document","className","speed","module","pOptions","options","Object","assign","window","_viewPort","_viewPortHeight","_className","_speed","_items","_scrollHandler","requestAnimationFrame","_render","bind","_loadHandler","pEvent","target","removeEventListener","_initaliseItem","find","pItem","image","element","elementWidth","clientWidth","elementHeight","clientHeight","coverHeight","Math","max","coverRatio","imageRatio","width","height","style","backgroundSize","elementTop","offsetTop","scrollEntry","scrollExit","ready","documentElement","pageYOffset","scrollTop","clientTop","viewPortScroll","_getViewPortScroll","viewPortHeight","forEach","elementHalf","elementCentre","intersectRangeTop","intersectRangeHeight","elementCentreNormalised","intersectRatio","heightDifference","backgroundOffsetNormalised","difRatio","backgroundPositionY","addEventListener","innerHeight","overflowY","position","loadHandler","getElementsByClassName","map","pElement","backgroundImage","getComputedStyle","Image","src","replace"],"mappings":"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"}