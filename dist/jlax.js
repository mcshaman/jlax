var JLax = (function () {
	'use strict';

	function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c);}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}if(("undefined"==typeof window?"undefined":_typeof(window))===void 0)throw new Error("jLax is a browser only library");var DEFAULT_OPTIONS={scroller:document,elements:".jlax",speed:1};function nullifyProperties(a){a._items=null,a._scroller=null,a._scrollerHeight=null,a._speed=null;}var jlax=function(){function a(b){var c=this;_classCallCheck(this,a),this.options=Object.assign({},DEFAULT_OPTIONS,b),nullifyProperties(this),this._scrollHandler=function(){requestAnimationFrame(c._render.bind(c));},this._loadHandler=function(a){a.target.removeEventListener("load",c._loadHandler),c._initaliseItem(c._items.find(function(b){return b.image===a.target}));};}return _createClass(a,[{key:"_initaliseItem",value:function i(a){var b=a.element,c=a.image,d=b.clientWidth,e=b.clientHeight;a.coverHeight=Math.max(this._scrollerHeight,e)*this._speed;var f=d/a.coverHeight,g=c.width/c.height;b.style.backgroundSize=f>g?"cover":"auto ".concat(a.coverHeight,"px");var h=b.offsetTop;a.scrollEntry=h-this._scrollerHeight,a.scrollExit=h+b.clientHeight,a.ready=!0,requestAnimationFrame(this._render.bind(this));}},{key:"_getScrollerPosition",value:function a(){if(this._scroller===window){var b=document.documentElement;return (window.pageYOffset||b.scrollTop)-(b.clientTop||0)}return this._scroller.scrollTop}},{key:"_render",value:function c(){var a=this,b=this._getScrollerPosition();this._items.forEach(function(c){if(!(!c.ready||c.scrollEntry>=b||c.scrollExit<=b)){var d=c.element.clientHeight/2,e=c.element.offsetTop+d,f=a._scrollerHeight+c.element.clientHeight,g=(f-(e-(b-d)))/f,h=c.coverHeight-a._scrollerHeight,i=f*g-c.coverHeight;c.element.style.backgroundPositionY="".concat(i+h*g,"px");}});}},{key:"initalise",value:function f(){var a=this,b=this.options;if(this._speed=b.speed,this._scroller=b.scroller===document?window:b.scroller,this._scroller.addEventListener("scroll",this._scrollHandler),this._scroller===window)this._scrollerHeight=window.innerHeight;else{this._scrollerHeight=this._scroller.clientHeight,this._scroller.style.overflowY="scroll";var c=getComputedStyle(this._scroller),d=c.position;"absolute"!==d&&"relative"!==d&&(this._scroller.style.position="relative");}var e;if("string"==typeof b.elements){var g=b.scroller===window?document:b.scroller;e=_toConsumableArray(g.querySelectorAll(b.elements));}else e=b.elements;return this._items=e.reduce(function(b,c){var d=getComputedStyle(c),e=d.backgroundImage;if(e){var f=/(?:url\(['"])((?:http(?:s)?:\/\/)?[\w.-]+(?:\.[\w.-]+)*[\w\-._~:/?#[\]@!$&'()*+,;=.]+)(?:['"]\))/g,g=f.exec(e);if(g){var h=new Image;h.src=g[1],h.addEventListener("load",a._loadHandler),b.push({element:c,ready:!1,image:h,coverHeight:null});}}return b},[]),this}},{key:"deinitialise",value:function a(){return this._scroller!==window&&(this._scroller.style.position="",this._scroller.style.overflowY=""),this._scroller.removeEventListener("scroll",this._scrollHandler),this._items.forEach(function(a){a.element.style.backgroundSize="",a.element.style.backgroundPositionY="";}),nullifyProperties(this),this}}]),a}();

	return jlax;

}());
//# sourceMappingURL=jlax.js.map
